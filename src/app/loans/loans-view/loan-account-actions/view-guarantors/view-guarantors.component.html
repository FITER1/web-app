<div class="container">

  <mat-card>

    <div class="viewGuarantors-account-tables" fxLayout="row" fxLayoutGap="2%">

      <div fxFlex="49%">
        <table>
          <tbody>
            <tr>
              <td>Disbursement Date</td>
              <td>{{dataObject.timeline.actualDisbursementDate}}<span
                  *ngIf="!dataObject.timeline.actualDisbursementDate">Not Available</span></td>
            </tr>
            <tr>
              <td>Currency</td>
              <td>{{dataObject.currency.name}}</td>
            </tr>
            <tr>
              <td>Loan Officer</td>
              <td>{{dataObject.loanOfficerName}} <span *ngIf="!dataObject.loanOfficerName">Unassigned</span>
                <span *ngIf="dataObject.loanOfficerName">
                  <fa-icon icon="times"></fa-icon>
                </span></td>
            </tr>
            <tr>
              <td>External Id</td>
              <td>{{dataObject.externalId}}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div fxFlex="49%">
        <table>
          <tbody>
            <tr>
              <td>Loan Purpose</td>
              <td>
                {{dataObject.loanPurposeName}} <span *ngIf="!dataObject.loanPurposeName"> Not Provided </span>
              </td>
            </tr>
            <tr>
              <td>Approved Amount</td>
              <td>
                <span>{{dataObject.approvedPrincipal | number}}</span>
              </td>
            </tr>
            <tr>
              <td>Disburse Amount</td>
              <td>
                <span>{{dataObject.principal | number}}</span>
              </td>
            </tr>
            <tr>
              <td>Arrears By</td>
              <td>{{dataObject.summary ? (dataObject.summary.totalOverdue | number) : 0}}
                <span *ngIf="dataObject.summary ? (dataObject.summary.totalOverdue < 0) : 0">Not Provided</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div fxFlexFill *ngIf="guarantorDetails" fxLayout="row wrap" fxLayout.lt-md="column">

      <!-- guarantors details table -->
      <div class="headingContent">
        <div fxLayout="column" fxFlex="50%">
          <div class="headingName">
            <h3>Guarantors Details</h3>
          </div>
        </div>
        <div fxLayout="column" fxFlex="50%">
          <div fxLayout="row" fxLayoutAlign="flex-end">
            <button mat-raised-button class="f-right" color="primary"
              (click)="toggleGuarantorsDetailsOverview()">{{showDeletedGuarantorsAccounts?'Hide Deleted Guarantors':'Show Deleted Guarantors'}}</button>
          </div>
        </div>
      </div>

      <table class="mat-table cdk-table mat-sort" role="grid">
        <thead role="rowgroup">
       
        <tr role="row" class="mat-header-row cdk-header-row ng-star-inserted">
            <th role="columnheader" class="mat-header-cell cdk-header-cell ng-star-inserted">Name</th>
            <th role="columnheader" class="mat-header-cell cdk-header-cell ng-star-inserted">Relationship</th>
            <th role="columnheader" class="mat-header-cell cdk-header-cell ng-star-inserted">Guarantortype</th>
            <th role="columnheader" class="mat-header-cell cdk-header-cell ng-star-inserted">Deposit Account</th>
            <th role="columnheader" class="mat-header-cell cdk-header-cell ng-star-inserted">Amount</th>
            <th role="columnheader" class="mat-header-cell cdk-header-cell ng-star-inserted">Remaining Amount</th>
            <th role="columnheader" class="mat-header-cell cdk-header-cell ng-star-inserted">Status</th>
            <th role="columnheader" class="mat-header-cell cdk-header-cell ng-star-inserted">Action</th>
        </tr>
        </thead>
        <tbody *ngFor="let guarantor of guarantorDetails|accountsFilter:'guarantor':showDeletedGuarantorsAccounts"  role="rowgroup">
        <tr
            *ngFor="let guarantorfund of guarantor.guarantorFundingDetails " class="mat-row cdk-row select-row ng-star-inserted">
            <td role="gridcell" class="mat-cell cdk-cell ng-star-inserted">{{guarantor.firstname}} &nbsp; {{guarantor.lastname}}</td>
            <td role="gridcell" class="mat-cell cdk-cell ng-star-inserted">
                <div *ngIf="dataObject.clientId != guarantor.entityId">{{guarantor.clientRelationshipType ? guarantor.clientRelationshipType.name : ''}}
                </div>
                <div *ngIf="dataObject.clientId == guarantor.entityId">Self</div>
            </td>
            <td role="gridcell" class="mat-cell cdk-cell ng-star-inserted">{{guarantor.guarantorType.value }}</td>
            <td role="gridcell" class="mat-cell cdk-cell ng-star-inserted">{{guarantorfund.savingsAccount.accountNo}}</td>
            <td role="gridcell" class="mat-cell cdk-cell ng-star-inserted">{{guarantorfund.amount | number}}</td>
            <td role="gridcell" class="mat-cell cdk-cell ng-star-inserted">{{guarantorfund.amountRemaining | number}}</td>
            <td role="gridcell" class="mat-cell cdk-cell ng-star-inserted">{{guarantorfund.status.value}}</td>
            <td role="gridcell" class="mat-cell cdk-cell ng-star-inserted">
              <span *ngIf="guarantor.guarantorFundingDetails">
                <button mat-raised-button class="account-action-button" color="primary"
                  *mifosxHasPermission="'READ_SAVINGSACCOUNT'" (click)="viewGuarantorDetails(guarantor)">
                  <fa-icon icon="eye"></fa-icon>&nbsp;&nbsp;
                </button>
                <button mat-raised-button class="account-action-button" color="primary"
                *mifosxHasPermission="'READ_SAVINGSACCOUNT'" [routerLink]= "['../../view-guarantor-transactions',guarantorfund.savingsAccount.id, guarantorfund.id]">
                  View Transactions
                </button>
                <span *ngIf="guarantor.status">
                  <button mat-raised-button class="account-action-button" color="warn"
                    *mifosxHasPermission='"DELETE_GUARANTOR"' (click)="deleteGuarantor(guarantor.id, guarantorfund.id)">
                    <fa-icon icon="trash"></fa-icon>&nbsp;&nbsp;
                  </button>
                </span>
              </span>
            </td>
        </tr>
        <tr *ngIf="!guarantor.guarantorFundingDetails">
            <td>{{guarantor.firstname}} &nbsp; {{guarantor.lastname}}</td>
            <td>{{guarantor.clientRelationshipType ? guarantor.clientRelationshipType.name : ''}}</td>
            <td>{{guarantor.guarantorType.value }}</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td *ngIf="guarantor.status">{{'guarantorFundStatusType.active'}}</td>
            <td *ngIf="guarantor.status">{{'guarantorFundStatusType.deleted'}}</td>
            <td>
              <span *ngIf="guarantor.guarantorFundingDetails">
                <button mat-raised-button class="account-action-button" color="primary"
                  *mifosxHasPermission="'READ_SAVINGSACCOUNT'" (click)="viewGuarantorDetails(guarantor)">
                  <fa-icon icon="eye"></fa-icon>&nbsp;&nbsp;
                </button>
                <button mat-raised-button class="account-action-button" color="primary"
                  *ngIf="guarantor.status && guarantor.guarantorType.id == 3 && guarantor.id">
                  <fa-icon icon="edit"></fa-icon>&nbsp;&nbsp;
                </button>
                <span *ngIf="guarantor.status">
                  <button mat-raised-button class="account-action-button" color="warn"
                    *mifosxHasPermission='"DELETE_GUARANTOR"' (click)="deleteGuarantor(guarantor.id)">
                    <fa-icon icon="trash"></fa-icon>&nbsp;&nbsp;
                  </button>
                </span>
              </span>
            </td>
        </tr>
        </tbody>
    </table>
      
    </div>

  </mat-card>

</div>
