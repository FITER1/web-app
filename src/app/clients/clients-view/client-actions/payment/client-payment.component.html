<div class="container">

  <mat-card>

    <form [formGroup]="clientPaymentForm" (ngSubmit)="submit()">

      <mat-card-content>

        <table mat-table [dataSource]="loanAccounts|accountsFilter:'loan'">

          <ng-container matColumnDef="Account No">
            <th mat-header-cell *matHeaderCellDef> Account No. </th>
            <td mat-cell *matCellDef="let element"> <i class="fa fa-stop"
                                                       [ngClass]="element.inArrears?'status-active-overdue':(element.status.code|statusLookup)"></i>
              {{element.accountNo}}
            </td>
          </ng-container>

          <ng-container matColumnDef="Loan Account">
            <th mat-header-cell *matHeaderCellDef> Loan Account </th>
            <td mat-cell *matCellDef="let element"> {{element.productName}} </td>
          </ng-container>

          <ng-container matColumnDef="Original Loan">
            <th mat-header-cell *matHeaderCellDef> Original Loan </th>
            <td mat-cell *matCellDef="let element"> {{element.lastActiveTransactionDate | date}} </td>
          </ng-container>
          <ng-container matColumnDef="Loan Balance">
            <th mat-header-cell *matHeaderCellDef>Loan Balance </th>
            <td mat-cell *matCellDef="let element"> {{element.loanBalance}} </td>
          </ng-container>

          <ng-container matColumnDef="Amount Paid">
            <th mat-header-cell *matHeaderCellDef> Amount Paid </th>
            <td mat-cell *matCellDef="let element"> {{element.accountBalance}} </td>
          </ng-container>

          <ng-container matColumnDef="Type">
            <th mat-header-cell *matHeaderCellDef> Type </th>
            <td mat-cell *matCellDef="let element">
              <i class="fa fa-large" [ngClass]="(element.loanType.value=== 'Individual')?'fa-user':'fa-group'" matTooltip=" {{ element.loanType.value }}" matTooltipPosition="above"></i>
            </td>
          </ng-container>

          <ng-container matColumnDef="Actions">
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let element">
              <button *ngIf="element.status.active" class="account-action-button" mat-raised-button color="primary" matTooltip="Make Repayment" matTooltipPosition="above"
                      (click)="routeEdit($event)" [routerLink]="['../','loans-accounts', element.id, 'actions', 'Make Repayment']">
                <i class="fa fa-dollar"></i>
              </button>
              <span *ngIf="element.status.pendingApproval">
          <button class="account-action-button" mat-raised-button color="primary" matTooltip="Approve"
                  matTooltipPosition="above" *mifosxHasPermission="'APPROVE_LOAN'" (click)="routeEdit($event)"
                  [routerLink]="['../','loans-accounts', element.id, 'actions', 'Approve']">
            <i class="fa fa-check"></i>
          </button>
        </span>
              <span *ngIf="!element.status.pendingApproval && !element.status.active && !element.status.overpaid">
          <button class="account-action-button" mat-raised-button color="primary" matTooltip="Disburse"
                  matTooltipPosition="above" *mifosxHasPermission="'DISBURSE_LOAN'"
                  (click)="routeEdit($event)" [routerLink]="['../','loans-accounts', element.id, 'actions', 'Disburse']">
            <i class="fa fa-flag"></i>
          </button>
        </span>
              <span *ngIf="!element.status.pendingApproval && !element.status.active && element.status.overpaid">
        <button class="account-action-button" mat-raised-button color="primary" matTooltip="Transfer Funds"
                matTooltipPosition="above" *mifosxHasPermission="'DISBURSE_LOAN'"
                (click)="routeEdit($event); routeTransferFund(element.id)">
          <i class="fa fa-exchange"></i>
        </button>
        </span>
            </td>
          </ng-container>

        </table>

        <table mat-table
               [dataSource]="savingAccounts|accountsFilter:'saving':'open':'isSavings'">

          <ng-container matColumnDef="Account No">
            <th mat-header-cell *matHeaderCellDef> Account No. </th>
            <td mat-cell *matCellDef="let element"> <i class="fa fa-stop" [ngClass]="element.status.code|statusLookup"></i>
              {{element.accountNo}} </td>
          </ng-container>

          <ng-container matColumnDef="Saving Account">
            <th mat-header-cell *matHeaderCellDef> Saving Account </th>
            <td mat-cell *matCellDef="let element"> {{element.productName}} </td>
          </ng-container>

          <ng-container matColumnDef="Last Active">
            <th mat-header-cell *matHeaderCellDef> Last Active </th>
            <td mat-cell *matCellDef="let element"> {{element.lastActiveTransactionDate | date}} </td>
          </ng-container>

          <ng-container matColumnDef="Balance">
            <th mat-header-cell *matHeaderCellDef> Balance </th>
            <td mat-cell *matCellDef="let element"> {{element.accountBalance}} </td>
          </ng-container>

          <ng-container matColumnDef="Actions">
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let element">
              <button *ngIf="element.status.active" class="account-action-button" mat-raised-button color="primary"
                      (click)="routeEdit($event)" [routerLink]="['../','savings-accounts', element.id, 'actions', 'Deposit']">
                <i class="fa fa-arrow-up"></i>
              </button>
              <button *ngIf="element.status.active" class="account-action-button" mat-raised-button color="primary"
                      (click)="routeEdit($event)" [routerLink]="['../','savings-accounts', element.id, 'actions', 'Withdrawal']">
                <i class="fa fa-arrow-down"></i>
              </button>
              <button *ngIf="element.status.submittedAndPendingApproval" class="account-action-button" mat-raised-button
                      color="primary" (click)="routeEdit($event)" [routerLink]="['../','savings-accounts', element.id, 'actions', 'Approve']">
                <i class="fa fa-check"></i>
              </button>
              <button *ngIf="!element.status.submittedAndPendingApproval && !element.status.active"
                      class="account-action-button" mat-raised-button color="primary"
                      [routerLink]="['../','savings-accounts', element.id, 'actions', 'Undo Approval']">
                <i class="fa fa-undo"></i>
              </button>
              <button *ngIf="!element.status.submittedAndPendingApproval && !element.status.active"
                      class="account-action-button" mat-raised-button color="primary"
                      [routerLink]="['../','savings-accounts', element.id, 'actions', 'Activate']">
                <i class="fa fa-check-circle"></i>
              </button>
            </td>
          </ng-container>

        </table>

      </mat-card-content>

    </form>

  </mat-card>

</div>
