<mat-card class="container">


    <div fxLayout="row" fxLayoutAlign="start right" fxLayoutGap="50">
      <!--div class="search-box"  fxFlex="100%">
        <mat-form-field fxFlex="30%">
          <input matInput placeholder="{{ 'labels.placeholders.customchargetypemap.search' | translateÂ }}" [formControl]="name" (keydown.enter)="loadClientallies($event.value)">
        </mat-form-field>
      </div-->
      
      <form [formGroup]="filterForm">

        <mat-form-field fxFlex="18%" formControlName="customChargeEntityid">
          <mat-label>{{ "labels.inputs.custom.charge.entity" | translate }}</mat-label>
          <mat-select required (selectionChange)="changeChargeEntityEvent($event.value)" [value]="customChargeEntityList.length > 0 ? customChargeEntityList[0].id : null">
            <mat-option *ngFor="let chargeTime of customChargeEntityList" [value]="chargeTime.id"  (selected)="1">
              {{ chargeTime.code | translate}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        &nbsp;&nbsp;&nbsp;
        <mat-form-field fxFlex="18%" formControlName="customChargeTypeid">
          <mat-label>{{ "labels.inputs.custom.charge.type" | translate }}</mat-label>
          <mat-select required (selectionChange)="changeChargeTypeEvent($event.value)">
            <mat-option *ngFor="let chargeTime of customChargeTypeList" [value]="chargeTime.id">
              {{ chargeTime.code | translate}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        &nbsp;&nbsp;&nbsp;
        <mat-form-field fxFlex="18%">
          <mat-label>{{"labels.inputs.term" | translate }}</mat-label>
          <input type="number" matInput formControlName="term" min=1>
          <mat-error *ngIf="filterForm.controls.term.hasError('required')">
            {{"labels.inputs.term" | translate }} {{ "labels.commons.is"  |translate}} <strong>{{ "labels.commons.required"  |translate}}</strong>
          </mat-error>
          <mat-error *ngIf="filterForm.controls.term.hasError('pattern')">
            {{"labels.inputs.term" | translate }} <strong>{{"labels.inputs.cannot" | translate }}</strong> {{ "labels.commons.begin with a special character or number" | translate }}
          </mat-error>
        </mat-form-field>
        &nbsp;&nbsp;&nbsp;
        <mat-form-field fxFlex="18%">
          <mat-label>{{"labels.inputs.percentage" | translate }}</mat-label>
          <input type='number' step='0.01' value='0.00' min=0 max=100 matInput formControlName="percentage">
          <mat-error *ngIf="filterForm.controls.percentage.hasError('required')">
            {{"labels.inputs.percentage" | translate }} {{ "labels.commons.is"  |translate}} <strong>{{ "labels.commons.required"  |translate}}</strong>
          </mat-error>
          <mat-error *ngIf="filterForm.controls.percentage.hasError('pattern')">
            {{"labels.inputs.percentage" | translate }} <strong>{{"labels.inputs.cannot" | translate }}</strong> {{ "labels.commons.begin with a special character or number" | translate }}
          </mat-error>
      </mat-form-field>
      &nbsp;&nbsp;&nbsp;
      <mat-form-field fxFlex="18%">
          <mat-label>{{"labels.inputs.validFrom" | translate }}</mat-label>
          <input required matInput formControlName="validFrom" [matDatepicker]="fromDatePicker">
          <mat-datepicker-toggle matSuffix [for]="fromDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #fromDatePicker></mat-datepicker>

          <mat-error *ngIf="filterForm.controls.validFrom.hasError('required')">
            {{"labels.inputs.validFrom" | translate }} {{ "labels.commons.is"  |translate}} <strong>{{ "labels.commons.required"  |translate}}</strong>
          </mat-error>
          <mat-error *ngIf="filterForm.controls.validFrom.hasError('pattern')">
            {{"labels.inputs.validFrom" | translate }} <strong>{{"labels.inputs.cannot" | translate }}</strong> {{ "labels.commons.begin with a special character or number" | translate }}
          </mat-error>
      </mat-form-field>        


      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <div class="action-button" fxLayoutGap="25px" >
          <button mat-raised-button color="danger" (click)="patchValues()">{{"labels.buttons.reset" | translate }}</button>
        </div>
        &nbsp;&nbsp;&nbsp;
        <div class="action-button" fxLayoutGap="25px" >
          <button mat-raised-button color="primary" [disabled]="!filterForm.valid" (click)="submit()" *mifosxHasPermission="'CREATE_CUSTOMCHARGETYPEMAP'">{{"labels.buttons.Submit" | translate }}</button>
        </div>
      </form>
    </div>
    
  
    <table mat-table [dataSource]="dataSource" #instructionsTable matSort *ngIf="reloaded">

      <ng-container matColumnDef="id"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.id"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData"  class="text-right"> {{ apiData.id }} </td>
      </ng-container>

      <ng-container matColumnDef="customChargeTypeId"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.customChargeTypeId"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData" style="text-align: right;"> <div >{{ apiData.customChargeTypeId }}</div> </td>
      </ng-container>

      <ng-container matColumnDef="term"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.term"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData"> {{ apiData.term }} </td>
      </ng-container>

      <ng-container matColumnDef="percentage"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.percentage"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData"> {{ apiData.percentage }} </td>
      </ng-container>

      <ng-container matColumnDef="validFrom"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.validFrom"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData"> {{ apiData.validFrom | dateFormat}} </td>
      </ng-container>

      <ng-container matColumnDef="validTo"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.validTo"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData"> {{ apiData.validTo | dateFormat }} </td>
      </ng-container>

      <ng-container matColumnDef="active"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.active"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData"> {{ apiData.active }} </td>
      </ng-container>

      <ng-container matColumnDef="createdBy"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.createdBy"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData"> {{ apiData.createdBy }} </td>
      </ng-container>

      <ng-container matColumnDef="createdAt"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.createdAt"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData"> {{ apiData.createdAt }} </td>
      </ng-container>

      <ng-container matColumnDef="updatedBy"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.updatedBy"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData"> {{ apiData.updatedBy }} </td>
      </ng-container>

      <ng-container matColumnDef="updatedAt"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.updatedAt"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData"> {{ apiData.updatedAt }} </td>
      </ng-container>


      <ng-container matColumnDef="actions"> 
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"labels.inputs.actions"  |translate}} </th>
        <td mat-cell *matCellDef="let apiData"> 

          <div class="action-button" fxLayoutGap="25px">
            <button mat-raised-button color="danger" (click) = "deleteEntityModal(apiData.id)"  *mifosxHasPermission="'CUSTOMCHARGETYPEMAP'">
              <i class="fa fa-trash" aria-hidden="true"></i>
           </button>
          </div>

        </td>
      </ng-container>      

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="select-row" (click)="fillValuesToEditCustomCharge(row.id, row.term, row.percentage, row.validFrom)"></tr>
  
    </table>
  
    <mat-paginator [length]="(apiData == null ? 0 : apiData.length)" [pageSize]="25" [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
  
    <mat-card-content>
      <!-- Structural directives like *ngIf break the canvas -->
      <div [ngStyle]="{'display': (customChargeTypeId == 0 || customChargeTypeId == null) ? 'none' : 'block'}">
        <canvas id="charge-line-chart" width="800" height="200"></canvas>
      </div>
  
    </mat-card-content>

  </mat-card>

  
  